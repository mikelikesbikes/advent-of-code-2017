require "rspec"

class PathFollower
  attr_reader :path, :waypoints, :steps
  attr_accessor :position, :heading

  def initialize(path)
    @path = path.split(/\n/)
    @waypoints = []
    inc_steps
    self.position = find_trailhead
    self.heading = :down
  end

  def walk
    while step; end
  end

  def step
    turn
    return nil unless path_at(*next_position)
    advance.tap { record_waypoint }
  end

  def next_position
    row, col = position
    case heading
    when :down
      [row + 1, col]
    when :up
      [row - 1, col]
    when :right
      [row, col + 1]
    when :left
      [row, col - 1]
    end
  end

  def advance
    inc_steps
    self.position = next_position
  end

  def turn
    return unless path_at(*position) == "+"
    possible_headings = case heading
    when :up, :down
      [:right, :left]
    when :right, :left
      [:up, :down]
    end

    self.heading = possible_headings.find do |new_heading|
      move_possible?(new_heading)
    end
  end

  def record_waypoint
    return unless /[A-Z]/ === (path_marker = path_at(*position))
    waypoints << path_marker
  end

  private

  def inc_steps
    @steps ||= 0
    @steps += 1
  end

  def move_possible?(heading)
    row, col = position
    case heading
    when :down
      path_at(row + 1, col)
    when :up
      path_at(row - 1, col)
    when :right
      path_at(row, col + 1)
    when :left
      path_at(row, col - 1)
    end
  end

  def path_at(row, col)
    return nil if row < 0 || row > path.length
    return nil if col < 0 || col > path[row].length

    path[row][col] == " " ? nil : path[row][col]
  end

  def find_trailhead
    [0, path[0].index("|")]
  end
end

describe PathFollower do
  let(:follower) { PathFollower.new(path) }
  let(:path) do
    <<-PATH
     |          
     |  +--+    
     A  |  C    
 F---|----E|--+ 
     |  |  |  D 
     +B-+  +--+ 
    PATH
  end

  specify "starting position" do
    expect(follower.position).to eq [0, 5]
  end

  specify "the sample puzzle" do
    follower.walk
    expect(follower.waypoints.join).to eq "ABCDEF"
    expect(follower.steps).to eq 38
  end

  describe "step" do
    it "moves vertically down to the next position" do
      expect { follower.step }.to change { follower.position }.to [1, 5]
    end

    it "turns on a +" do
      follower.position = [5, 5]
      expect { follower.step }.to change { follower.position }.to [5, 6]
    end

    it "records waypoints" do
      follower.position = [1, 5]
      expect { follower.step }.to change { follower.waypoints }.to ["A"]
    end
  end
end

return if /rspec$/ === $PROGRAM_NAME

path = <<-PATH
                                                                                                                                                             |                                           
 +-------------------------------+           +-------------+           +-+   +---------------------+     +-------+                       +-----------------------------------------+       +-----+       
 |                               |           |             |           | |   |                     |     |       |                       |                   |                     |       |     |       
 +-----+ +-----------------------------------|---+         |           | |   |     +---+           +-----|---------------+     +---------------+ +-----+ +---|---------------------|-------+ +---|-+ +-+ 
       | |                       |           |   |         |           | |   |     |   |                 |       |       |     |         |     | |     | |   |                     |         |   | | | | 
       +-|---+ +-----------------|---------------|---+     | +---------|-|-+ | +---|---|---------------------+   +---+   |     |         |     +-|-----|-|---|-----------------+   +---------|-------|-+ 
         |   | |                 |           |   |   |     | |         | | | | |   |   |                 |   |       |   |     |         |       |     | |   |                 |             |   | | |   
         |   | +-----------------|-------------------|-----|-|---------|-------|---+   |                 |   +-----------|-----|-----------+     |     | |   |             +---+           +-----|-|---+ 
         |   |                   |           |   |   |     | |         | | | | |       |                 |           |   |     |         | |     |     | |   |             |               | |   | | | | 
         |   +-------------------|---------------|-----------|-----------|-+ | +-------------------------|---+     +-|---------|---------|-|-----|-----------|-----------------------------------|-|-+ | 
         |                       |           |   |   |     | |         | |   |         |                 |   |     | |   |     |         | |     |     | |   |             |               | |   | |   | 
   +-+   | +---+ +-----------------------------------|---------------------+ +---------------------------|-----------|---|-----------------------------------|-------+     |       +---------+   | |   | 
   | |   | |   | |               |           |   |   |     | |         | | |           |                 |   |     | |   |     |         | |     |     | |   |       |     |       |       |     | |   | 
   | |   +-----------------------------------|---------------|-------------|-----------|-----------+     |   |     | |   |     |     +---|-|-----|-----------+       |   +---------------------+ | |   | 
   | |     |   | |               |           |   |   |     | |         | | |           |           |     |   |     | |   |     |     |   | |     |     | |           |   | |       |       |   | | |   | 
   | |     |   | |               | +-----------------|-----------------|-|-|-----------|-----------|-----|---|-----|-|---+     |   +-|---|-------|-------|---+   +---|---|-+ +-----|-----------|---|-+ | 
   | |     |   | |               | |         |   |   |     | |         | | |           |           |     |   |     | |         |   | |   | |     |     | |   |   |   |   |   |     |       |   | | | | | 
   | | +---|---|---------------------------+ |   |   |     | | +---------|-|---+       |           |     |   |     | |         |   | |   +-+     |     | +---|---|------P|-+ |     |       |   | +-+ | | 
   | | |   |   | |               | |       | |   |   |     | | |       | | |   |       |           |     |   |     | |         |   | |           |     |     |   |   |   | | |     |       |   |     | | 
   | | | +-|---|-|---------------|---------|---------|-+   | | |     +---|-----|-------|-----------|-----+   +---------------------|-------------|-----------|-------|-----+ |     |       |   |     | | 
   | | | | |   | |               | |       | |   |   | |   | | |     | | | |   |       |           |               | |         |   | |           |     |     |   |   |   |   |     |       |   |     | | 
   | | | | | +-------------------|---------|---------|-|-+ | | |     | | | |   |       |           |               | |         |   | |           |   +-|-----|---|-------------------------+ +-|---+ +-+ 
   | | | | | | | |               | |       | |   |   | | | | | |     | | | |   |       |           |               | |         |   | |           |   | |     |   |   |   |   |     |         | |   |     
   | | | | | | | |         +-----|---------------------|-+ | | |     | +-|-------------|-----+     |               | |         |   | |           |   | |     +-----------|---|---+ |         | |   |     
   | | | | | | | |         |     | |       | |   |   | |   | | |     |   | |   |       |     |     |               | |         |   | |           |   | Y         |   |   |   |   | |         | |   |     
   | | | | | | | |       +---+ +-----------|-|-------+ |   | | +-----|---|-----|-----------------------------+ +---------------|-----|---------------|-------+   |   |   |   |   | |         | |   |     
   | | | | | | | |       | | | | | |       | |   |     |   | |       |   | |   |       |     |     |         | |   | |         |   | |           |   | |     |   |   |   |   |   | |         | |   |     
   +-|-|-----|---|-------------|-|-|-------|-|---|-----|---|-------------|-|---+   +---------|-----|-----------------------+   +-----|-----------|---|-------+   +-----+ |   |   | |         | |   |     
     | | | | | | |       | | | | | |       | |   |     |   | |       |   | |       |   |     |     |         | |   | |     |       | |           |   | |             | | |   |   | |         | |   |     
     | | | | | | |       | | | | | |       | |   |     |   | |       |   | |       |   |     |     |         | |   | |     +-------|-------------|---+ +-------------|-|-|-+ |   | |         | |   |     
     | | | | | | |       | | | | | |       | |   |     |   | |       |   | |       |   |     |     |         | |   | |             | |           |                   | | | | |   | |         | |   |     
 +-----|-|-----|-|-------|-|-----------------|-------------|-|-----+ | +---+ +-------------------------------------|V----------------|-----------|---------------------------|---------------|-----+     
 |   | | | | | | |       | | | | | |       | |   |     |   | |     | | | |   |     |   |     |     |         | |   | |             | |           |                   | | | | |   | |         | |         
 |   | | | | | | |     +-----------|-+     | |   |     |   | |     | | | | +-|-----|---------|-----|-----------+   | |           +-|---------------------------------|-|-+ | |   | |       +-------+     
 |   | | | | | | |     | | | | | | | |     | |   |     |   | |     | | | | | |     |   |     |     |         |     | |           | | |           |                   | |   | |   | |       | | |   |     
 | +-|-|---|-|-|-------|---|---|-----|-----|-|---+   +-----|-|-----|-|-+ | | |     |   |     |     |         | +---+ |           | | |           |                   | |   | |   | |       | | |   |     
 | | | | | | | | |     | | | | | | | |     | |       | |   | |     | |   | | |     |   |     |     |         | |     |           | | |           |                   | |   | |   | |       | | |   |     
 | +-|-----|---|-|----Q----|-----+ | U +-----|-------|-----|-|-------|---|---+     |   |     |     |         | |     |     +-----|-|-----------------------------------|---------|---------|-----+ |     
 |   | | | | | | |     | | | | |   |   |   | |       | |   | |     | |   | |       |   |     |     |         | |     |     |     | | |           |                   | |   | |   | |       | | | | |     
 |   | | | | | | |     | | | | | +-------------------|-----|-|-----------|-|-----------------------|---------|-------------|---------------------|-----------+       | |   | |   | |       | | | | |     
 |   | | | | | | |     | | | | | | |   |   | |       | |   | |     | |   | |       |   |     |     |         | |     |     |     | | |           |           |       | |   | |   | |       | | | | |     
 |   | | | | +-|-------+ | | | +-|-----|---|-|---------|---|-|-----|-+   | |     +-|---|-----|-----------+   | |     |     |     | | |           |           |       | |   | | +-|-|-------+ | | | |     
 |   | | | |   | |       | | |   | |   |   | |       | |   | |     |     | |     | |   |     |     |     |   | |     |     |     | | |           |           |       | |   | | | | |         | | | |     
 |   | | | |   | |       | | |   | +---------|-------|-----|-----------------------|---------|---------+ |   | |     +-----|-----+ | |           |           |       | +-+ | | | | |         | | | |     
 |   | | | |   | |       | | |   |     |   | |       | |   | |     |     | |     | |   |     |     |   | |   | |           |       | |           |           |       |   | | | | | |         | | | |     
 |   | | | |   | |       +-|-|-------------|---+     | |   | |     |     | |     | |   |     |     |   | |   | |           |       | |           |           |       |   | | | | | |         | | | |     
 |   | | | |   | |         | |   |     |   | | |     | |   | |     |     | |     | |   |     |     |   | |   | |           |       | |           |           |       |   | | | | | |         | | | |     
 | +-|-|---|-------------------------+ |   | | |     | |   | |     |     | |     | | +-------|-----|---|-+   | |           |       | |           |           |       |   | | | | | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     | |   | |     |     | |     | | | |     |     |   |     | |           |       | |           |           |       |   | | | | | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     | |   | |     |     | |     | | | |     |     +-----------|-----------|-----------+         |   +-------------------+ | | | | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     | |   | |     |     | |     | | | |     |         |     | |           |       | | |         |   |       |       |     | | | | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     | +---|---+   |     | |     | | | |     |         |     | |           |       | | |         |   | +-----|-------------|---+ | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     |     | | |   |     | |     | | | |     |         |     | |           |       | | |         |   | |     |       |     | |   | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     |     | | |   |     | | +---|-|-|-|---------------------|-|-------------------|-+ |         |   | |     |       |     | |   | |         | | | |     
 | | | | | |   | |         | |   |   | |   | | |     |     | | |   |     | | |   | | | |     |         |     | |           |       |   |         |   | |     |       |     | |   | |         | | | |     
 | | | | | |   | |         | |   |   | |   | +-|-----|-------------|-----|-|-----------|-----|---+     +-----|---------------------|---|-------+ |   | |     |       |     | |   | |         | | | |     
 | | | | | |   | |         | |   |   | |   |   |     |     | | |   |     | | |   | | | |     |   |           | |           |       |   |       | |   | |     |       |     | |   | |         | | | |     
 | | | | | | +---+         | |   |   | |   |   |     |     | | |   |     +-|-----+ | | |     |   |           | |           |       |   |       | |   | |     |       |     | |   | |         | | | |     
 | | | | | | | |           | |   |   | |   |   |     |     | | |   |       | |     | | |     |   |           | |           |       |   |       | |   | |     |       |     | |   | |         | | | |     
 | | +-+ | | +-|-----------|---------|-|---|---|-------------------|-------|-----------|-----|---|-----------|-------------+       |   +-------|-|-----|-----|-------|-----------|-|-----------+ | |     
 | |     | |   |           | |   |   | |   |   |     |     | | |   |       | |     | | |     |   |           | |                   |           | |   | |     |       |     | |   | |         |   | |     
 | |     | |   |           | |   |   | | +-|---|-----|---------+   +-+     | |     +-|-----------|----B--------|-+                 |           | | +-+ |   +---+     |   +-|-|---+ |         |   | |     
 | |     | |   |           | |   |   | | | |   |     |     | |       |     | |       | |     |   |           | | |                 |           | | |   |   | | |     |   | | |     |         |   | |     
 | |     | |   +-----------|-----|---|-|-+ |   |     | +-----|-------------|-|---------|-----|---|-----------|-+ |                 |         +-|-+ |   |   | | |     |   | | |     |         |   | |     
 | |     | |               | |   |   | |   |   |     | |   | |       |     | |       | |     |   |           |   |                 |         | |   |   |   | | |     |   | | |     |         |   | |     
 | |     | |               | |   |   | |   |   | +---|-----|---------|---------------------------|-----------|---|-----------+     |         | |   |   |   | | |     |   | | |     |         |   | |     
 | |     | |               | |   |   | |   |   | |   | |   | |       |     | |       | |     |   |           |   |           |     |         | |   |   |   | | |     |   | | |     |         |   | |     
 | |     | |               | |   |   | |   +---|-----|---------------+     | |       | |     |   |           |   |         +-|-----|---------|-|-------|---|-|-|-----|---|---+     |         |   | |     
 | |     | |               | |   |   | |       | |   | |   | |             | |       | |     |   |           |   |         | |     |         | |   |   |   | | |     |   | |       |         |   | |     
 | |     | |               | |   |   | |       | |   | |   | |     +-------|-|-------|-----+ |   +-----------|---|---------|-------|---------|-----|-------|-|-|-----|---|-|-+     |         |   | |     
 | |     | |               | |   |   | |       | |   | |   | |     |       | |       | |   | |               |   |         | |     |         | |   |   |   | | |     |   | | |     |         |   | |     
 | |     | |               | |   |   | |       | |   | |   | |     |       | |       | |   | |               |   |         | |     +-----------|---|---------|-|-----|-+ | | |     |         |   | |     
 | |     | |               | |   |   | |       | |   | |   | |     |       | |       | |   | |               |   |         | |               | |   |   |   | | |     | | | | |     |         |   | |     
 | | +---|-----------------|-|-+ |   | |       | +---|-+ +---------|-------------------------|---+           |   |         | |               | |   |   |   | | |     | | | | |     |         |   | |     
 | | |   | |               | | | |   | |       |     |   | | |     |       | |       | |   | |   |           |   |         | |               | |   |   |   | | |     | | | | |     |         |   | |     
 | | |   | |               | +-+ | +-|---------|---------|-----------------------------|-----|---------------|-------------|-|-----------------+ +-|---|-------|---+ | | | | |     |         |   | |     
 | | |   | |               |     | | | |       |     |   | | |     |       | |       | |   | |   |           |   |         | |               |   | |   |   | | |   | | | | | |     |         |   | |     
 | | |   | |           +---|-----|---|-----+   | +---|-------|-----|-------|-|---------|---------------------|---|---------|---------------------------|---|-|-|---|---------------|---+ +-+ |   | |     
 | | |   | |           |   |     | | | |   |   | |   |   | | |     |       | |       | |   | |   |           |   |         | |               |   | |   |   | | |   | | | | | |     |   | | | |   | |     
 | | |   | |     +-----+   +-+   | | | |   |   | |   |   | | |     | +-----|-|-----+ | |   | | +-|-----------|---------------|-------------------------|-----|-|---+ | | | | |     |   | | | |   | |     
 | | |   | |     |           |   | | | |   |   | |   |   | | |     | |     | |     | | |   | | | |           |   |         | |               |   | |   |   | | |     | | | | |     |   | | | |   | |     
 | +-+   | |     |     +---------|---|-|---+   | |   |   | | |   +-|-------+ |     | | |   | | | |           |   |         | |         +-----+   | |   |   +-|-----------+ | |     |   | | | |   | |     
 |       | |     |     |     |   | | | |       | |   |   | | |   | | |       |     | | |   | | | |           |   |         | |         |         | |   |     | |     | |   | |     |   | | | |   | |     
 |       | |     |     |     |   | | | |       | |   |   | | |   | +---------------|-|-|---|-----|-----------------------------------------------|-|---|---------------|---|-----+ |   | | | |   | |     
 |       | |     |     |     |   | | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         | |         |         | |   |     | |     | |   | |   | |   | | | |   | |     
 |       | |     |     |     |   | | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         | +-------------------|-----|-------|---+ | |   | |   | |   | | | |   | |     
 |       | |     |     |     |   | | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |           |         | |   |     | |   | | |   | |   | |   | | | |   | |     
 |       | |     |     |     |   +-|-|---------|-----------------|-------------------|-|---|-----------------|---|---------|---------+ |         | |   |     | |   | | |   | |   | |   | | | |   | |     
 |       | |     |     |     |     | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | |   | | |   | |   | |   | | | |   | |     
 |       | |     |     |     |     | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | |   | | |   | |   | |   | | | |   | |     
 |       | |     |     |     |     | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | |   | | |   | |   | |   | | | |   | |     
 |       | +-----|-----|-------+   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     | +---|-|-|---|-------|-+ | | | |   | |     
 |       |       |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |     
 |       |   +---------|-----|-|---|---|-------|-|-----------|-----------------------|-----|-|---------------|-------------|-----------|---------|-------------------|-------|---|---|-|---|-|---|-----+ 
 |       |   |   |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |   | 
 |       |   |   |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |   | 
 |       |   |   |     |     | |   | | |       | |   |   | | |   |   |       |     | | |   | | | |           |   |         |         | |         | |   |     |     | | |   | |   | | | | | | |   | |   | 
 +-+     |   |   |     |     | |   | | |       | +-------+ | |   |   | +-----|-------+ |   | | | |           |   |         |         | +-----------|---|-----------|-|-+ +-+ |   | | | | | | |   | |   | 
   |     |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |           | |   |     |     | |   |   |   | | | | | | |   | |   | 
 +-----+ |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |           | |   |     |     | |   |   |   | | | | | | |   | |   | 
 | |   | |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |           | |   |     |     | |   |   |   | | | | | | |   | |   | 
 +-----|-|-------|-------------------|-|-------|-----------|-|---|---------------------|-----|---|-------------------------|---------|---+       | |   |     |     | |   |   |   | | | | +-----------+ | 
   |   | |   |   |     |     | |   | | |       |     |     | |   |   | |     |     |   |   | | | |           |   |         |         |   |       | |   |     |     | |   |   |   | | | |   | |   | | | | 
   |   | |   |   |     |     | |   | | |       |     |   +-|-|---------|-----------|---|---|---------------------|-------------------+   | +-+   | |   | +-----------|-+ |   |   | | | |   | |   | | | | 
   |   | |   |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |   | | | |           |   |         |             | | |   | |   | |   |     | | | |   |   | | | |   | |   | | | | 
 +-----|-----|-----------------|-----|---------|-------------|---------------------|---|-+ +-|-|-------------|-------------|-------------|-|-----+ |   | |   |     | | | |   |   | | | |   | |   | | | | 
 | |   | |   |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   | |   | | |           |   |         |             | | |     |   | |   |     | | | |   |   | | | |   | |   | | | | 
 | +-------+ |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   | +---|---|-----------|---|-------+ |             | | |     |   | |   |     | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |       | |             | | |     |   | |   |     | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |       +---------------|---|-----|-------------+ | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |     | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |             | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |   +-|-----|---|-------|---------|---|---|---|-------|-----|-----------|-------------------------------+         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |   | | |   | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |   |         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |   | +---+ | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |   |         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | | 
 |     | | | |   |     |   |   | | | | |       |     |   | | |   |   | |     |     |   |     | | |           |   |         |   |         | | |     |   | |   |   | | | | |   |   | | | |   | |   | | | | 
 |   +-|-|-------|-----+   |   | | | | |       |     |   | | |   +-----|---+ |     |   |     | | |           |   |         |   |         | +-|-----------|---|---|-|---|-|---------|-|-----|-|-+ | | | | 
 |   | | | | |   |         |   | | | | |       |     |   | | |       | |   | |     |   |     | | |           |   |         |   |         |   |     |   | |   |   | | | | |   |   | | | |   | | | | | | | 
 |   | | | | |   |         |   | | | | |       |     |   | | |       | |   | |     |   |     | | |           |   |         |   |         |   |     |   | |   |   | | | | |   |   | | | |   | | | | | | | 
 |   | | | | |   |         |   | | | | |       |     |   | | |       | |   | |     |   |     | | |           |   |         |   |         |   |     |   | |   |   | | | | |   |   | | | |   | | | | | | | 
 |   | | | | |   |         |   | | | | |       |     |   | | |       | +---|-|-+   |   |     | | |           |   |         |   | +-------|---|---------+ |   +---+ | | | | +-----|-+ | |   | | | | | | | 
 |   | | | | |   |         |   | | | | |       |     |   | | |       |     | | |   |   |     | | |           |   |         |   | |       |   |     |     |         | | | | | |   |   | |   | | | | | | | 
 |   | | | | |   |   +-----|---|-|-|-|---------------|-----|-|-------|-----|-|-|-------|-----|-----------------------------+   | |       |   |     |     |     +-----|-+ | | |   | +-+ |   | | | | | | | 
 |   | | | | |   |   |     |   | | | | |       |     |   | | |       |     | | |   |   |     | | |           |   |             | |       |   |     |     |     |   | |   | | |   | |   |   | | | | | | | 
 |   | | | | |   |   |     | +---|-|-|-------------------|-|-|-------|-------|---------|-------|-|---------------|-------------|-|---------------------+ |     |   | |   | | +-----|-------+ | | | | | | 
 |   | | | | |   |   |     | | | | | | |       |     |   | | |       |     | | |   |   |     | | |           |   |             | |       |   |     |   | |     |   | |   | |     | |   |     | | | | | | 
 |   | | | | |   +---------|-----|---|-|-------+     |   | | |   +-+ | +---|-|-+   +---------|-|-|-----------|---+             | |       |   |     |   | |     |   | |   | |     | |   |     | | | | | | 
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   | |         |     | | |           |                 | |       |   |     |   | |     |   | |   | |     | |   |     | | | | | | 
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   | |     +-------------|-------+   +-------------------+       |   |     |   +-------|---|-|-------+   | |   |     | | | | | | 
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   | |     |   |     | | |       |                     |         |   |     |     |     |   | |   | | |   | |   |     | | | | | | 
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   +-------|---------|-|-|-+     |                     |         |   |   +-------|---------|-----|---|---|---+ | +-+ | | | | | | 
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |     |     |   |     | | | |     |                     |         |   |   | |     |     |   | |   | | |   | | | | | | | | | | | | 
 |   | | | | |       |     | | | | | | |             |   | | |   | | | |   +-------|---|-----|-|---|---------------------------|-------------|---|-|-----|-----|---|-------|-|---|---+ | | | | | | | | | 
 |   | | | | |       |     | | | | | F |             |   | | |   | | | |   | |     |   |     | | | |     |                     |         |   |   | |     |     |   | |   | | |   | |   | | | | | | | | | 
 |   | | | | |       |     | | | | | | |             |   +---+   | | | |   | +-----|---|---------------------------------------|---------|---+   +-|-----------|-----+   | +-+   | |   | | | | | | | | | 
 |   | | | | |       |     | | | | | | |             |     |     | | | |   |       |   |     A | | |     |                     |         |         |     |     |   |     |       | |   | | | | | | | | | 
 +---|-|-+ | |   +---------|---|---|---+             |     |     | | | |   |       |   |     | | | |     |   +-----------------------------------------+ |     |   |     |       | |   | | | | | | | | | 
     | |   | |   |   |     | | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | | | | | | | | 
     | | +-----------|-+   +-|-|-|-|-|---------------------|-------|-|-|-----------|---|-----|-|---------|---|-----------------|---------|---------------|-----|---|---------------|-----|-|-+ | | | | | 
     | | | | |   |   | |     | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | |   | | | | | 
 +-------|-|-|-------------+ | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | |   | | | | | 
 |   | | | | |   |   | |   | | | | | |               |     |     | | | |   |       |   |     | | | |     |   |                 |         |         |   | |     |   |     |       | |   | | |   | | | | | 
 |   | | | | |   |   | |   | | | | | |               |     |     | | | |   |       |   |     | | | +---------------+           |         |         |   | |     |   |     |       | |   | | |   | | | | | 
 |   | | | | |   |   | |   | | | | | |               |     |     | | | |   |       |   |     | | |       |   |     |           |         |         |   | |     |   |     |       | |   | | |   | | | | | 
 |   | | | | |   |   | |   | | | | | | +-------------|-----------------|-----------|---|-----|-|---------|-------------------------+     |         |   | |     |   |     |       | |   | | |   | | | | | 
 |   | | | | |   |   | |   | | | | | | |             |     |     | | | |   |       |   |     | | |       |   |     |           |   |     |         |   | |     |   |     |       | |   | | |   | | | | | 
 |   | | | | |   | +-|-+   | | | | | | |             |     |     | | | |   |       |   |     | | |       |   |     |           +---|-------------------|-|-----|---|-------------|-|-----|-----+ | | | | 
 |   | | | | |   | | |     | | | | | | |             |     |     | | | |   |       |   |     | | |       |   |     |               |     |         |   | |     |   |     |       | |   | | |     | | | | 
 |   | | | | | +-|---|-+   | | | | | | |             |     |     | | | |   |     +-+   |     | | |       |   |     |               |     +---------|-----|-----|---|-----|-------|-------|-|---+ | | | | 
 |   | | | | | | | | | |   | | | | | | |             |     |     | | | |   |     |     |     | | |       |   |     |               |               |   | |     |   |     |       | |   | | |   | | | | | 
 +---|---+ | | | | | | +-+ | | | | | | |             |     |     | | | |   |     |     |     | | |       |   |     |               |             +-|-----|---+ +-----------+     | |   | | |   | | | | | 
     | |   | | | | | |   | | | | | | | |             |     |     | | | |   |     |     |     | | |       |   |     |               |             | |   | |   |     |     | |     | |   | | |   | | | | | 
     +---+ +---|-+ | |   | | | | | | | |   +---------|-+   |     | | | |   |     |     |     | | |       |   |     |               |             | |   | |   |     |     | |     | |   | | |   | | | | | 
       | |   | |   | |   | | | | | | | |   |         | |   |     | | | |   |     |     |     | | |       |   |     |               |             | |   | |   |     |     | |     | |   | | |   | | | | | 
 +-------|---------|---------|-|---|-|-----|-----------|-----------|---|--W------------|---------------------|-----|-------------+ |             | |   | |   |     |     | |     | |   | | |   | | | | | 
 |     | |   | |   | |   | | | | | | | |   |         | |   |     | | | |   |     |     |     | | |       |   |     |             | |             | |   | |   |     |     | |     | |   | | |   | | | | | 
 |     | |   | +---|-|---|-----|-+ | | | +---+       | |   |     | | +-|---------------------|---|-------|-----------------------------------------|-----|---------|-----|-|-----|-----|---|-------|-+ | 
 |     | |   |     | |   | | | |   | | | | | |       | |   |     | |   |   |     |     |     | | |       |   |     |             | |             | |   | |   |     |     | |     | |   | | |   | | |   | 
 |     | | +-|-----|---+ | | +-----|---|---|-|---------|---|-----+ | +-+   |     |     |     | | |       |   |     |             | |             | |   | |   |     |     | +-----+ |   | | |   +-|-|-+ | 
 |     | | | |     | | | | |   |   | | | | | |       | |   |       | |     |     |     |     | | |       |   |     |             | |             | |   | |   |     |     |         |   | | |     | | | | 
 |     | | | |     | | | +---------|-+ | | | |       | |   |       | |     |     |     |     | | |       |   |     |             | |             | |   | |   |     |     |         |   | | |     | | | | 
 |     | | | |     | | |   |   |   |   | | | |       | |   |       | |     |     |     |     | | |       |   |     |             | |             | |   | |   |     |     |         |   | | |     | | | | 
 |     | | | |     | | |   |   |   |   | | | |       | |   |   +---|-+     |     |     |     | | |       |   |     |             | |       +-----|-----|-|---|-----------+         |   | | |     | | | | 
 |     | | | |     | | |   |   |   |   | | | |       | |   |   |   |       |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |     | | | | 
 |     | +---|-----|-------|---|---|---|-|-|-+       | |   |   |   |   +---|-----|-----|-----------------|---|-----|-------------|---------------------|-----------|-------------------|---|-----+ | | | 
 |     |   | |     | | |   |   |   |   | | |         | |   |   |   |   |   |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |       | | | 
 |     |   | |     | | |   |   |   |   | | |         | |   |   |   |   |   |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |       | | | 
 |     |   | |     | | |   |   |   |   | | |         | |   |   |   |   |   |     |     |     | | |       |   |     |             | |       |     | |   | |   |     |               |   | | |       | | | 
 +-------------------|-|-+ |   |   |   | | |         | |   |   |   |   +---------|---------------|-------|---------|-------------+ +-------+     +-|-+ | |   |     |               |   +-|-|-------|-+ | 
       |   | |     | | | | |   |   |   | | |         | |   |   |   |       |     |     |     | | |       |   |     |                               | | | |   |     |               |     | |       |   | 
       |   | |   +-|-|-+ | |   |   |   | | |         | |   |   |   +-------|---------------------|-----------|-----|-------------------------------+ | | |   |     |               |     | |       +-+ | 
       |   | |   | | |   | |   |   |   | | |         | |   |   |           |     |     |     | | |       |   |     |                                 | | |   |     |               |     | |         | | 
       |   | |   +-|-|---------|-----+ | | |         | |   |   |         +-------------|-------|-------------|-----|-----------------------------------|-|---------|-----------------------|-+       | | 
       |   | |     | |   | |   |   | | | | |         | |   |   |         | |     |     |     | | |       |   |     |                                 | | |   |     |               |     | | |       | | 
       |   | |     | |   | |   |   | | | | |         | |   |   |         | |     |     |     | | |       |   |     |                                 | +-----|-----|-------------------+ | | |       | | 
       |   | |     | |   | |   |   | | | | |         | |   |   |         | |     |     |     | | |       |   |     |                                 |   |   |     |               |   | | | |       | | 
       |   +-------+ |   | |   +-----|-|-|-|---------------|---|---+   +---------------|-----+ +---------|---+     |                                 |   |   |     |               |   | | | |       | | 
       |     |       |   | |       | | | | |         | |   |   |   |   | | |     |     |         |       |         |                                 |   |   |     |               |   | | | |       | | 
       |     |       |   | |       | | | +-+         | |   |   +---+ +-----|-----------|---------|-----------------|-------------------------------+ |   |   |     |               |   | | | |       | | 
       |     |       |   | |       | | |             | |   |         | | | |     |     |         |       |         |                               | |   |   |     |               |   | | | |       | | 
       |     |       |   | |       | | |             | |   |         | | | |     |     |         |       |         |                               | |   |   |     |               | +-|-|-------+   | | 
       |     |       |   | |       | | |             | |   |         | | | |     |     |         |       |         |                               | |   |   |     |               | | | | | |   |   | | 
       |     |       |   | |       | | |             | |   +-----------|-|-------|-----|---------+       |         |                 +-------------|-----|-------------------------|-|-|-+ | |   |   +-+ 
       |     |       |   | |       | | |             | |             | | | |     |     |                 |         |                 |             | |   |   |     |               | | |   | |   |       
 +-----+ +---+ +-------------------|-----------------+ |           +-|-+ +-------------------------------+         |                 |         +-------------------|---------------|---+   | |   |       
 |       |     |     |   | |       | | |               |           | |     |     |     |                           |                 |         |   | |   |   |     |               | |     | |   |       
 |       |     +---------|-|-----------|-----------------------------------+     +-----|-----------------------------------------------------------|-|-------------|-----------------|-+   | |   | +---+ 
 |       |           |   | |       | | |               |           | |                 |                           |                 |         |   | |   |   |     |               | | |   | |   | |   | 
 |       |     +-----|---|-------------|-----------------------------------------------|---------------------------|-----------------|---------|---|-+   |   |     +-----------------|-+   | |   | |   | 
 |       |     |     |   | |       | | |               |           | |                 |                           |                 |         |   |     |   |                     | |     | |   | |   | 
 +-----------+ +-----+   | |       | +-+   +-----------|-----------|-----------------------------------------------+                 |         +---+     |   +-----------------------------|-+   | |   | 
         |   |           | |       |       |           |           | |                 |                                             |                   |                         | |     |     | |   | 
 +-------|---|-----------+ |       |       |           |           | |                 +-------------------------+                   +-------------------+ +-+                     | |     |     | |   | 
 |       |   |             |       |       |           |           | |                                           |                                         | |                     | |     |     | |   | 
 |       |   |             |       |       |           +---------------------------------------------------------------------------------------------------+ |                     | |     |     | |   | 
 |       |   |             |       |       |                       | |                                           |                                           |                     | |     |     | |   | 
 +-------|---+             |       +--------------------------------T|-------------------------------------------|-----------------------------------------------------------------|-|-----|-------+   | 
         |                 |               |                       | |                                           |                                           |                     | |     |     |     | 
         +-----------------------------------------------------------|---------------------------------------------------------------------------------------|-------------------+ +-+     +-----+     | 
                           |               |                       | |                                           |                                           |                   |                     | 
                           +---------------+                       +-+                                           +-------------------------------------------+                   +---------------------+ 
                                                                                                                                                                                                         
PATH

follower = PathFollower.new(path)
follower.walk
puts follower.waypoints.join
puts follower.steps

